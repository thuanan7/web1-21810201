<!DOCTYPE html>
<html lang="en">
	<head>
		<title>21810201 - Web1 Project</title>
		<!-- Required meta tags -->
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, shrink-to-fit=no"
		/>

		<!-- Favicon -->
		<link rel="shortcut icon" href="images/favicon.ico" />

		<!--Font awesome-->
		<script
			src="https://kit.fontawesome.com/f456414f35.js"
			crossorigin="anonymous"
		></script>

		<!-- Google Font-->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Changa+One&display=swap"
			rel="stylesheet"
		/>

		<!-- Bootstrap CSS v5.2.1 -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT"
			crossorigin="anonymous"
		/>

		<!-- Web1 CSS -->
		<link rel="stylesheet" href="css/21810201.css" />
	</head>

	<body>
		<header class="container">
			<nav class="navbar navbar-expand-sm navbar-light">
				<div class="container">
					<a class="navbar-brand" href="#">
						<img src="/images/logo.png" alt="Web1 logo" />
					</a>
					<button
						class="navbar-toggler d-lg-none"
						type="button"
						data-bs-toggle="collapse"
						data-bs-target="#menu-header"
						aria-controls="collapsibleNavId"
						aria-expanded="false"
						aria-label="Toggle navigation"
					>
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="menu-header">
						<ul class="navbar-nav ms-auto mt-2 mt-lg-0">
							<li class="nav-item">
								<a
									class="nav-link"
									href="/index.html"
									aria-current="page"
									>Home
									<span class="visually-hidden"
										>(current)</span
									></a
								>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="/about.html">About</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="/gallery.html"
									>Gallery</a
								>
							</li>
							<li class="nav-item active">
								<a class="nav-link" href="/blogs.html">Blogs</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="/contacts.html"
									>Contacts</a
								>
							</li>
							<li class="nav-item">
								<a
									class="nav-link"
									href="#"
									data-bs-toggle="modal"
									data-bs-target="#modalLogin"
									>Login</a
								>
							</li>
						</ul>
						<form
							class="d-flex my-2 my-lg-0 border rounded-pill"
							id="formSearch"
						>
							<input
								class="form-control ms-3 border-0"
								type="text"
								placeholder="Search"
							/>
							<button
								class="btn my-2 my-sm-0 border-0"
								type="submit"
							>
								<i class="fa-solid fa-magnifying-glass"></i>
							</button>
						</form>
					</div>
				</div>
			</nav>
		</header>

		<section id="banner-small"></section>

		<section class="container py-5">
			<div class="row">
				<div class="col-8" id="blogs"></div>
				<div class="col-4" id="blogs-categories"></div>
			</div>
		</section>

		<!-- footer -->
		<footer class="text-center container-fluid text-white py-3">
			<ul class="nav justify-content-center py-3" id="menu-footer">
				<li class="nav-item">
					<a class="nav-link" href="#" aria-current="page">Home</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/about.html">About</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/gallery.html">Gallery</a>
				</li>
				<li class="nav-item">
					<a class="nav-link active" href="/blogs.html">Blogs</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/contacts.html">Contacts</a>
				</li>
				<li class="nav-item">
					<a
						class="nav-link"
						href="#"
						data-bs-toggle="modal"
						data-bs-target="#modalLogin"
						>Login</a
					>
				</li>
			</ul>
			<p class="text-white-50">
				Copyright &copy; 2023 by Nguyễn Thuận An - 21810201
			</p>
		</footer>

		<!-- Modal Body -->
		<!-- if you want to close by clicking outside the modal, delete the last endpoint:data-bs-backdrop and data-bs-keyboard -->
		<div
			class="modal fade"
			id="modalLogin"
			tabindex="-1"
			data-bs-backdrop="static"
			data-bs-keyboard="false"
			role="dialog"
			aria-labelledby="modalTitleId"
			aria-hidden="true"
		>
			<div
				class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-md"
				role="document"
			>
				<div class="modal-content">
					<div class="modal-header">
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Close"
						></button>
					</div>
					<div class="modal-body">
						<form action="#" method="post" id="formLogin">
							<h3 class="text-center">Login Form</h3>
							<div class="mb-3">
								<input
									type="text"
									name="username"
									id="username"
									class="form-control"
									placeholder="username"
								/>
								<div class="mb-3">
									<input
										type="password"
										name="password"
										id="password"
										placeholder="password"
										class="form-control"
									/>
								</div>
								<button type="submit" class="form-control">
									Login
								</button>
							</div>
						</form>
					</div>
					<div class="modal-footer"></div>
				</div>
			</div>
		</div>

		<!-- Bootstrap JavaScript Libraries -->
		<script
			src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
			integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
			crossorigin="anonymous"
		></script>

		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
			integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz"
			crossorigin="anonymous"
		></script>

		<!-- Custom js -->
		<script src="js/21810201.js"></script>

		<!-- Include Handlebars from a CDN -->
		<script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
		<script src="js/handlebars-pagination-helper.js"></script>

		<script
			id="blogs-categories-template"
			type="text/x-handlebars-template"
		>
			<h1>Categories</h1>
			<ul class="py-3">
				{{#each data}}
					<li><a
							class="text-black-50 text-decoration-none"
							href="#"
							onclick="loadBlogs('blogs/categories/{{id}}')"
						>{{name}}</a>
					</li>
				{{/each}}
			</ul>
		</script>

		<script id="blogs-template" type="text/x-handlebars-template">
			<h1>Blogs</h1>
			{{#each data.data}}
				<div class="clearfix py-3">
					<h3>{{name}}</h3>
					<p class="text-black-50">
						by
						{{author}}
						in
						<a
							href="#"
							onclick="loadBlogs('blogs/categories/{{category.id}}')"
						>{{category.name}}</a>
						on
						{{formatDate date}}.
						<a href="#comments" onclick="loadBlogDetail({{id}}, true)">Comments ({{comments.length}})</a>
					</p>
					<img
						src="{{thumbpath}}"
						alt="{{name}}"
						class="float-start me-3 border rounded-4"
					/>
					<p class="text-black-50">
						{{summary}}
					</p>
					<a href="#" class="btn btn-link readmore ps-0" onclick="loadBlogDetail({{id}})">Read more</a>
				</div>
			{{/each}}

			{{#with data}}
			{{#pagination currentPage pageCount}}
			<nav aria-label="Page navigation">
				<ul class="pagination">
					{{#each pages}}
					{{#if isCurrent}}
					<li class="page-item disabled" aria-current="page">
						<a class="page-link" href="#">{{page}}</a>
					</li>
					{{/if}}
					{{#unless isCurrent}}
					<li class="page-item">
						<a class="page-link" href="#" onclick="loadBlogs('{{../../request}}', {{page}})">{{page}}</a>
					</li>
					{{/unless}}
					{{/each}}
				</ul>
			</nav>
			{{/pagination}}
			{{/with}}
		</script>

		<script id="details-template" type="text/x-handlebars-template">
			<h1>Blogs</h1>
			{{#each data}}
				<div class="py-3">
					<h3>{{name}}</h3>
					<p class="text-black-50">by
						{{author}}
						in
						{{category.name}}
						on
						{{formatDate date}}
						.
						<a href="#">Comments ({{comments.length}})</a></p>
					<img
						src="{{imagepath}}"
						alt="{{name}}"
						class="float-start me-3 rounded-4"
					/>
					<div class="text-black-50">{{{description}}}</div>
				</div>
				<div class="py-3">
					<h3>Leave your comments</h3>
					<form action="#" method="post" class="text-black-50">
						<div class="row">
							<div class="col-4">
								<div class="mb-3">
									<label for="name" class="form-label">Name
										(Required)</label>
									<input
										type="text"
										class="form-control"
										name="name"
										id="name"
										placeholder=""
										required
									/>
								</div>
							</div>
							<div class="col-4">
								<div class="mb-3">
									<label for="email" class="form-label">Email
										(Required)</label>
									<input
										type="email"
										class="form-control"
										name="email"
										id="email"
										placeholder=""
										required
										pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
									/>
								</div>
							</div>
						</div>
						<div class="mb-3">
							<textarea
								class="form-control"
								name="message"
								id="message"
								rows="3"
								placeholder="Enter your message here"
								required
							></textarea>
						</div>
						<div class="row">
							<div class="col">
								<div class="form-check form-check-inline">
									<input
										class="form-check-input"
										type="checkbox"
										id="agree"
										name="agree"
										value="1"
										required
									/>
									<label
										class="form-check-label"
										for="agree"
									>Agree to terms and conditions</label>
								</div>
							</div>
							<div class="col text-end">
								<button type="submit" class="btn btn-link py-0 my-0">Submit Comment</button>
							</div>
						</div>
					</form>
				</div>

				<a name="comments"></a>
				<div class="bg-dark text-white-50 p-2">
					COMMENTS ({{{comments.length}}})
				</div>

				<div class="py-3 text-black-50">
					{{#each comments}}
					<div>
						<p>{{name}} - {{formatDate date}}</p>
						<p>{{summary}}</p>
						<hr>
					</div>
					{{/each}}
				</div>
			{{/each}}
		</script>

		<script>
			Handlebars.registerHelper("formatDate", function (date) {
				let formatDate = new Date(date);
				let options = {
					weekday: "short",
					year: "numeric",
					month: "short",
					day: "numeric",
					timeZoneName: "short",
				};
				return formatDate.toLocaleString("en-US", options);
			});

			function loadBlogs(request, currentPage = 1) {
				const contextProps = {
					request,
					currentPage,
				};
				getData(
					`${request}?page=${currentPage}`,
					"blogs-template",
					"blogs",
					contextProps
				);
			}

			getData(
				"blogs-categories",
				"blogs-categories-template",
				"blogs-categories"
			);

			loadBlogs("blogs");
			
			async function loadBlogDetail(blogId, gotoComments=false) {
				await getData(`blogs/${blogId}`, 'details-template', 'blogs');
				if (gotoComments) {
					window.location.href = "#comments";
				}
			}
		</script>
	</body>
</html>
